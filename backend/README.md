# ChessRobot316 - backend
Тут будет лежать серверное приложение, связывающее мобильные, десктопные и веб-клиенты с роботом.

Коммиты в эту дирректорию осуществляйте с префиксом CHESS316-BACK, пример: "CHESS316-BACK-1: initial commit"


Основные классы проекта

1. Session
    Назначение: Управляет игровой сессией, состоянием шахматной доски и игроками.

    Ключевые атрибуты:

    active_players — количество активных игроков в сессии.

    players — список объектов игроков (или None для покинувших игроков).

    is_active — признак, активна ли сессия.

    current_player — индекс текущего игрока (0 или 1).

    board — объект шахматной доски (использует библиотеку chess).

    Основные методы:

    add_player(websocket=None) — добавляет игрока (белого или черного) в сессию.

    delete_player(websocket) — удаляет игрока по его соединению.

    reset() — сбрасывает сессию к начальному состоянию.

    return_board() — возвращает текущее состояние доски в FEN-нотации.

    make_move(move) — выполняет ход на доске (в формате UCI), возвращает успех/неуспех.

    check_gameover() — проверяет завершение партии.

    check_square(pos) — возвращает фигуру на клетке, если она есть, иначе None.

2. Player
    Назначение: Представляет игрока в сессии.

    Ключевые атрибуты:

    websocket — WebSocket-соединение игрока.

    figures_color — цвет фигур игрока (Colors.WHITE или Colors.BLACK).

3. Colors (Enum)
    Назначение: Перечисление для цветов фигур.

    WHITE — белые фигуры.

    BLACK — черные фигуры.

4. RobotConnector
    Назначение: Управляет TCP-соединением с физическим шахматным роботом.

    Ключевые атрибуты:

    host — адрес робота (берется из переменной окружения ROBOT_HOST).

    port — порт робота (берется из переменной окружения ROBOT_PORT).

    socket — TCP-сокет для связи с роботом.

    Основные методы:

    connect() — устанавливает соединение с роботом.

    send_and_receive(message) — отправляет команду роботу и возвращает ответ.

    close() — закрывает соединение.

5. RedisConnector
    Назначение: Обеспечивает взаимодействие с базой данных Redis.

    Ключевые атрибуты:

    host — адрес Redis (из переменной окружения REDIS_HOST).

    port — порт Redis (из переменной окружения REDIS_PORT).

    db — номер базы данных.

    client — клиент Redis.

    Основные методы:

    connect() — устанавливает соединение с Redis.

    disconnect() — закрывает соединение.

    execute(command, *args) — выполняет команду Redis и возвращает результат.

6. WebSocketServer
    Назначение: Основной сервер, управляющий WebSocket-соединениями, игровой логикой, связью с роботом и Redis.

    Ключевые атрибуты:

    robot_conn — экземпляр RobotConnector.

    redis_conn — экземпляр RedisConnector.

    session — экземпляр Session.

    Основные методы:

    send_message(message, websocket) — отправляет сообщение клиенту.

    broadcast(message) — рассылает сообщение всем игрокам.

    handle_message(message, websocket) — обрабатывает входящее сообщение клиента.

    handle_move(message, websocket) — обрабатывает ход игрока.

    handle_board_state(websocket) — отправляет клиенту состояние доски.

    broadcast_success_move() — рассылает обновлённое состояние игры.

    init_game() — отправляет игрокам сообщение о начале игры и их цветах.

    handle_client(websocket) — обрабатывает жизненный цикл клиента.

    async_return_board() — асинхронно возвращает доску в исходное состояние.

    run() — запускает сервер.